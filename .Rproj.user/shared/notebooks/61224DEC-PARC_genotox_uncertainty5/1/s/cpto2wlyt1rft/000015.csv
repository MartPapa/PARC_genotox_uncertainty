"0","EFSAgenotoxDB_filtered_comp_lit <- EFSAgenotoxDB_filtered %>%"
"0","  group_by(genotoxguidelinefulltxt, com_name, literature_reference) %>%"
"0"," mutate(result_lit = ifelse(all(results == ""Negative""),""negative"", ifelse(any(results == ""Positive""), ""positive"", ""other"")))%>%"
"0","  ungroup()%>%"
"0","  distinct(genotoxguidelinefulltxt, com_name, literature_reference, .keep_all = TRUE)  %>%"
"0"," group_by(genotoxguidelinefulltxt, com_name)%>%"
"0","  mutate("
"0","    n_repl_pos_lit = sum(result_lit == ""positive""),"
"0","    n_repl_neg_lit = sum(result_lit == ""negative""),"
"0","    n_repl_other_lit = sum(result_lit == ""other""),"
"0","    n_repl_total_lit= n())%>%"
"0","  filter(n_repl_total_lit >2)%>%"
"0","  distinct(genotoxguidelinefulltxt, com_name, .keep_all = TRUE)%>%"
"0","  mutate("
"0","    majority_lit = case_when("
"0","      n_repl_pos_lit == max(n_repl_pos_lit, n_repl_neg_lit, n_repl_other_lit) ~ ""pos"","
"0","      n_repl_neg_lit == max(n_repl_pos_lit, n_repl_neg_lit, n_repl_other_lit) ~ ""neg"","
"0","      n_repl_other_lit == max(n_repl_pos_lit, n_repl_neg_lit, n_repl_other_lit) ~ ""other""),"
"0","    similarity_lit = ifelse(majority_lit == ""pos"", n_repl_pos_lit / n_repl_total_lit, ifelse(majority_lit == ""neg"", n_repl_neg_lit / n_repl_total_lit, "
"0","           n_repl_other_lit / n_repl_total_lit)))%>%"
"0","  mutate(below_66_range_lit = similarity_lit <= 0.66, "
"0","         in_66_85_range_lit = similarity_lit > 0.66 & similarity_lit <= 0.85,"
"0","         above_85_range_lit = similarity_lit > 0.85)%>%  "
"0","  ungroup()%>%"
"0","    group_by(genotoxguidelinefulltxt)%>%"
"0","  mutate(n_comp_perTG_lit = n_distinct(com_name, literature_reference))%>%"
"0","  ungroup()"
"0",""
"0","EFSAgenotoxDB_filtered_comp_maj_lit <- EFSAgenotoxDB_filtered_comp_lit %>%"
"0","  group_by(genotoxguidelinefulltxt, majority_lit, below_66_range_lit, in_66_85_range_lit, above_85_range_lit)%>%"
"0"," mutate("
"0","  n_comp_majority_bia_lit = n())%>%"
"0","  mutate(perc_comp_bia_lit = round((n_comp_majority_bia_lit/n_comp_perTG_lit)*100, 1)) %>%"
"0","  ungroup()"
"0",""
"0","EFSAgenotoxDB_filtered_comp_maj_TG_lit <- EFSAgenotoxDB_filtered_comp_maj_lit %>%"
"0","  group_by(genotoxguidelinefulltxt)%>%"
"0","  mutate("
"0","    n_comp_below_66_range_lit = sum(below_66_range_lit, na.rm = TRUE),"
"0","    n_comp_in_66_85_range_lit = sum(in_66_85_range_lit, na.rm = TRUE),"
"0","    n_comp_above_85_range_lit = sum(above_85_range_lit, na.rm = TRUE),"
"0","    perc_below66_lit = round((n_comp_below_66_range_lit / n_comp_perTG_lit) * 100, 1),"
"0","    perc_66_85_lit = round((n_comp_in_66_85_range_lit / n_comp_perTG_lit) * 100, 1),"
"0","    perc_above85_lit = round((n_comp_above_85_range_lit / n_comp_perTG_lit) * 100, 1),"
"0","    min_replicates_perComp_perTG_lit = min(n_repl_total_lit, na.rm = TRUE),   "
"0","    median_replicates_perComp_perTG_lit = median(n_repl_total_lit, na.rm = TRUE),"
"0","    max_replicates_perComp_perTG_lit = max(n_repl_total_lit, na.rm = TRUE),"
"0","    genotoxguidelinefulltxt =gsub(""OECD Guideline"", ""RefGrouped_TG"", genotoxguidelinefulltxt)) %>%"
"0","  rename(TG_analysis = genotoxguidelinefulltxt)%>%"
"0","  "
"0","  select(com_name, com_casnumber, TG_analysis, method_type, majority_lit, below_66_range_lit, in_66_85_range_lit, above_85_range_lit, n_comp_majority_bia_lit, perc_comp_bia_lit, n_comp_below_66_range_lit,n_comp_in_66_85_range_lit, n_comp_above_85_range_lit, n_comp_perTG_lit, perc_below66_lit, perc_66_85_lit, perc_above85_lit, min_replicates_perComp_perTG_lit, median_replicates_perComp_perTG_lit, max_replicates_perComp_perTG_lit) %>%"
"0",""
"0","  mutate(TG_analysis = case_when("
"0","    TG_analysis == ""UnGrouped_TG 489"" ~ ""RefGrouped_TG 489 (In vivo mammalian COMET)"", TRUE ~ TG_analysis))"
"0","  "
"0",""
"0","write_xlsx(EFSAgenotoxDB_filtered_comp_maj_TG_lit, here::here(""tables"", ""EFSAgenotoxDB_filtered_comp_maj_TG_lit.xlsx""))"
"0",""
"0","#split data-frame"
"0",""
"0","variability_per_TG_lit <-EFSAgenotoxDB_filtered_comp_maj_TG_lit %>%"
"0","  distinct(TG_analysis, .keep_all=TRUE)%>%"
"0","  select(TG_analysis,n_comp_below_66_range_lit,n_comp_in_66_85_range_lit, n_comp_above_85_range_lit, n_comp_perTG_lit, perc_below66_lit, perc_66_85_lit, perc_above85_lit, min_replicates_perComp_perTG_lit, median_replicates_perComp_perTG_lit, max_replicates_perComp_perTG_lit)"
"0",""
"0","pos_neg_distribution_per_TG_lit <-EFSAgenotoxDB_filtered_comp_maj_TG_lit %>%"
"0","  distinct(TG_analysis, majority_lit, below_66_range_lit, in_66_85_range_lit, above_85_range_lit, .keep_all=TRUE)%>%"
"0","  select(TG_analysis, method_type, majority_lit, below_66_range_lit, in_66_85_range_lit, above_85_range_lit, n_comp_majority_bia_lit, perc_comp_bia_lit)"
"0",""
"0","write_xlsx(variability_per_TG_lit, here::here(""tables"", ""variability_per_TG_lit.xlsx""))"
"0","write_xlsx(pos_neg_distribution_per_TG_lit, here::here(""tables"", ""pos_neg_distribution_per_TG_lit.xlsx""))"
