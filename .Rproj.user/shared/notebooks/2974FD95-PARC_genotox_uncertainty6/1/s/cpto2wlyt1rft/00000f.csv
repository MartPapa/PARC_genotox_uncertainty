"0","EFSAgenotoxDB_filtered_comp_lit <- EFSAgenotoxDB_filtered %>%"
"0","  group_by(genotoxguidelinefulltxt, com_name, literature_reference) %>%"
"0"," mutate(result_lit = ifelse(all(results == ""Negative""),""negative"", ifelse(any(results == ""Positive""), ""positive"", ""other"")))%>%"
"0","  ungroup()%>%"
"0","  distinct(genotoxguidelinefulltxt, com_name, literature_reference, .keep_all = TRUE)  %>%"
"0"," group_by(genotoxguidelinefulltxt, com_name)%>%"
"0","  mutate("
"0","    n_repl_pos = sum(result_lit == ""positive""),"
"0","    n_repl_neg = sum(result_lit == ""negative""),"
"0","    n_repl_other = sum(result_lit == ""other""),"
"0","    n_repl_total= n())%>%"
"0","  filter(n_repl_total >2)%>%"
"0","  distinct(genotoxguidelinefulltxt, com_name, .keep_all = TRUE)%>%"
"0","  mutate("
"0","    majority = case_when("
"0","      n_repl_pos == max(n_repl_pos, n_repl_neg, n_repl_other) ~ ""pos"","
"0","      n_repl_neg == max(n_repl_pos, n_repl_neg, n_repl_other) ~ ""neg"","
"0","      n_repl_other == max(n_repl_pos, n_repl_neg, n_repl_other) ~ ""other""),"
"0","    similarity = ifelse(majority == ""pos"", n_repl_pos / n_repl_total, ifelse(majority == ""neg"", n_repl_neg / n_repl_total, "
"0","           n_repl_other / n_repl_total)))%>%"
"0","  mutate(below_66_range = similarity <= 0.66, "
"0","         in_66_85_range = similarity > 0.66 & similarity <= 0.85,"
"0","         above_85_range = similarity > 0.85)%>%  "
"0","  ungroup()%>%"
"0","    group_by(genotoxguidelinefulltxt)%>%"
"0","  mutate(n_comp_perTG = n_distinct(com_name, literature_reference))%>%"
"0","  ungroup()"
"0",""
"0","EFSAgenotoxDB_filtered_comp_maj_lit <- EFSAgenotoxDB_filtered_comp_lit %>%"
"0","  group_by(genotoxguidelinefulltxt, majority, below_66_range, in_66_85_range, above_85_range)%>%"
"0"," mutate("
"0","  n_comp_majority_bia = n())%>%"
"0","  mutate(perc_comp_bia = round((n_comp_majority_bia/n_comp_perTG)*100, 1)) %>%"
"0","  ungroup()"
"0",""
"0","EFSAgenotoxDB_filtered_comp_maj_TG_lit <- EFSAgenotoxDB_filtered_comp_maj_lit %>%"
"0","  group_by(genotoxguidelinefulltxt)%>%"
"0","  mutate("
"0","    n_comp_below_66_range = sum(below_66_range, na.rm = TRUE),"
"0","    n_comp_in_66_85_range = sum(in_66_85_range, na.rm = TRUE),"
"0","    n_comp_above_85_range = sum(above_85_range, na.rm = TRUE),"
"0","    perc_below66 = round((n_comp_below_66_range / n_comp_perTG) * 100, 1),"
"0","    perc_66_85 = round((n_comp_in_66_85_range / n_comp_perTG) * 100, 1),"
"0","    perc_above85 = round((n_comp_above_85_range / n_comp_perTG) * 100, 1),"
"0","    min_replicates_perComp_perTG = min(n_repl_total, na.rm = TRUE),   "
"0","    median_replicates_perComp_perTG = median(n_repl_total, na.rm = TRUE),"
"0","    max_replicates_perComp_perTG = max(n_repl_total, na.rm = TRUE),"
"0","    genotoxguidelinefulltxt =paste0(gsub(""OECD Guideline"", ""TG"", genotoxguidelinefulltxt), "" RefGr"")) %>%"
"0","  rename(TG_analysis = genotoxguidelinefulltxt)%>%"
"0","  "
"0","  select(com_name, com_casnumber, TG_analysis, method_type, majority, below_66_range, in_66_85_range, above_85_range, n_comp_majority_bia, perc_comp_bia, n_comp_below_66_range,n_comp_in_66_85_range, n_comp_above_85_range, n_comp_perTG, perc_below66, perc_66_85, perc_above85, min_replicates_perComp_perTG, median_replicates_perComp_perTG, max_replicates_perComp_perTG) %>%"
"0",""
"0","mutate("
"0","  TG_analysis = str_replace(TG_analysis, ""TG 489"", ""TG 489 (In vivo COMET)""))%>%"
"0","mutate(TG_analysis = str_replace(TG_analysis, ""Mammalian"", """"))"
"0","  "
"0",""
"0","write_xlsx(EFSAgenotoxDB_filtered_comp_maj_TG_lit, here::here(""tables"", ""EFSAgenotoxDB_filtered_comp_maj_TG_lit.xlsx""))"
"0",""
"0","#split data-frame"
"0",""
"0","variability_per_TG_lit <-EFSAgenotoxDB_filtered_comp_maj_TG_lit %>%"
"0","  distinct(TG_analysis, .keep_all=TRUE)%>%"
"0","  select(TG_analysis,n_comp_below_66_range,n_comp_in_66_85_range, n_comp_above_85_range, n_comp_perTG, perc_below66, perc_66_85, perc_above85, min_replicates_perComp_perTG, median_replicates_perComp_perTG, max_replicates_perComp_perTG)"
"0",""
"0","pos_neg_distribution_per_TG_lit <-EFSAgenotoxDB_filtered_comp_maj_TG_lit %>%"
"0","  distinct(TG_analysis, majority, below_66_range, in_66_85_range, above_85_range, .keep_all=TRUE)%>%"
"0","  select(TG_analysis, method_type, majority, below_66_range, in_66_85_range, above_85_range, n_comp_majority_bia, perc_comp_bia)%>%"
"0","arrange(TG_analysis, majority, above_85_range, in_66_85_range, below_66_range)"
"0",""
"0","write_xlsx(variability_per_TG_lit, here::here(""tables"", ""variability_per_TG_lit.xlsx""))"
"0","write_xlsx(pos_neg_distribution_per_TG_lit, here::here(""tables"", ""pos_neg_distribution_per_TG_lit.xlsx""))"
